{% extends 'admin/base_site.html' %} {% block content %}
<h1>Admin Dashboard</h1>
<div style="display: flex; gap: 2rem; margin-bottom: 2rem">
  <div
    style="
      background: #1a4c7e;
      padding: 1.5rem;
      border-radius: 8px;
      min-width: 180px;
    "
  >
    <h3>Total Orders</h3>
    <div style="font-size: 2rem; font-weight: bold">{{ order_count }}</div>
  </div>
  <div
    style="
      background: #1a4c7e;
      padding: 1.5rem;
      border-radius: 8px;
      min-width: 180px;
    "
  >
    <h3>Total Sales</h3>
    <div style="font-size: 2rem; font-weight: bold">
      ${{ total_sales|floatformat:2 }}
    </div>
  </div>
  <div
    style="
      background: #1a4c7e;
      padding: 1.5rem;
      border-radius: 8px;
      min-width: 180px;
    "
  >
    <h3>Products</h3>
    <div style="font-size: 2rem; font-weight: bold">{{ product_count }}</div>
  </div>
</div>
<h2>Recent Orders</h2>
<table
  class="admin-dashboard-table"
  style="width: 100%; border-collapse: collapse"
>
  <thead>
    <tr>
      <th
        style="border-bottom: 1px solid #ccc; text-align: left; padding: 0.5rem"
      >
        Order ID
      </th>
      <th
        style="border-bottom: 1px solid #ccc; text-align: left; padding: 0.5rem"
      >
        User
      </th>
      <th
        style="border-bottom: 1px solid #ccc; text-align: left; padding: 0.5rem"
      >
        Status
      </th>
      <th
        style="border-bottom: 1px solid #ccc; text-align: left; padding: 0.5rem"
      >
        Total
      </th>
      <th
        style="border-bottom: 1px solid #ccc; text-align: left; padding: 0.5rem"
      >
        Date
      </th>
    </tr>
  </thead>
  <tbody>
    {% for order in recent_orders %}
    <tr>
      <td style="padding: 0.5rem">{{ order.id }}</td>
      <td style="padding: 0.5rem">{{ order.user.username }}</td>
      <td style="padding: 0.5rem">{{ order.status }}</td>
      <td style="padding: 0.5rem">${{ order.total|floatformat:2 }}</td>
      <td style="padding: 0.5rem">{{ order.created_at|date:'Y-m-d H:i' }}</td>
    </tr>
    {% empty %}
    <tr>
      <td colspan="5">No recent orders.</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<h2 style="margin-top:2.5rem;">All Orders</h2>
<table class="admin-dashboard-table" style="width:100%; border-collapse: collapse; margin-bottom:2rem;">
  <thead>
    <tr>
      <th style="border-bottom: 1px solid #ccc; text-align:left; padding: 0.5rem;">Order ID</th>
      <th style="border-bottom: 1px solid #ccc; text-align:left; padding: 0.5rem;">Customer</th>
      <th style="border-bottom: 1px solid #ccc; text-align:left; padding: 0.5rem;">Address</th>
      <th style="border-bottom: 1px solid #ccc; text-align:left; padding: 0.5rem;">Total</th>
      <th style="border-bottom: 1px solid #ccc; text-align:left; padding: 0.5rem;">Date</th>
      <th style="border-bottom: 1px solid #ccc; text-align:left; padding: 0.5rem;">Status</th>
      <th style="border-bottom: 1px solid #ccc; text-align:left; padding: 0.5rem;">Change Status</th>
    </tr>
  </thead>
  <tbody>
    {% for order in all_orders %}
    <tr>
      <td style="padding: 0.5rem;">{{ order.id }}</td>
      <td style="padding: 0.5rem;">{{ order.user.username }}</td>
      <td style="padding: 0.5rem;">
        {{ order.shipping_address }}, {{ order.shipping_city }}, {{ order.shipping_postal_code }}, {{ order.shipping_country }}
      </td>
      <td style="padding: 0.5rem;">${{ order.total|floatformat:2 }}</td>
      <td style="padding: 0.5rem;">{{ order.created_at|date:'Y-m-d H:i' }}</td>
      <td style="padding: 0.5rem;">{{ order.get_status_display }}</td>
      <td style="padding: 0.5rem;">
        <form method="post" action="{% url 'admin-update-order-status' order.id %}" style="display:inline;">
          {% csrf_token %}
          <select name="status">
            {% for value, label in status_choices %}
              <option value="{{ value }}" {% if order.status == value %}selected{% endif %}>{{ label }}</option>
            {% endfor %}
          </select>
          <button type="submit" style="margin-left:0.5rem;">Update</button>
        </form>
      </td>
    </tr>
    {% empty %}
    <tr><td colspan="7">No orders found.</td></tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
